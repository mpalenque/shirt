<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"></script>
    <title>Background Replacement</title>
</head>
<body>
    <div class="container">
        <video class="input_video" style="display: none"></video>
        <canvas class="output_canvas" width="1280px" height="720px"></canvas>
    </div>
    <script>
        const videoElement = document.querySelector('.input_video');
        const canvasElement = document.querySelector('.output_canvas');
        const canvasCtx = canvasElement.getContext('2d');

        function onResults(results) {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            
            // Draw the webcam image
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
            
            // Draw the segmentation mask
            if (results.segmentationMask) {
                canvasCtx.globalCompositeOperation = 'destination-in';
                canvasCtx.drawImage(results.segmentationMask, 0, 0, canvasElement.width, canvasElement.height);
                
                // Set background color (here it's blue, you can change the color)
                canvasCtx.globalCompositeOperation = 'destination-over';
                canvasCtx.fillStyle = '#0000FF';  // Blue background
                canvasCtx.fillRect(0, 0, canvasElement.width, canvasElement.height);
            }
            
            canvasCtx.restore();
        }

        const selfieSegmentation = new SelfieSegmentation({
            locateFile: (file) => {
                return `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`;
            }
        });
        
        selfieSegmentation.setOptions({
            modelSelection: 1,
        });

        selfieSegmentation.onResults(onResults);

        // Start webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then((stream) => {
                videoElement.srcObject = stream;
                videoElement.play();
                
                const processFrame = async () => {
                    await selfieSegmentation.send({ image: videoElement });
                    requestAnimationFrame(processFrame);
                };
                
                requestAnimationFrame(processFrame);
            });
    </script>
</body>
</html>